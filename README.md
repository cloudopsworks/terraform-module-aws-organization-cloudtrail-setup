<!-- 
  ** DO NOT EDIT THIS FILE
  ** 
  ** This file was automatically generated. 
  ** 1) Make all changes to `README.yaml` 
  ** 2) Run `make init` (you only need to do this once)
  ** 3) Run`make readme` to rebuild this file. 
  -->
[![README Header][readme_header_img]][readme_header_link]

[![cloudopsworks][logo]](https://cloudops.works/)

# Terraform AWS Organization Cloudtrail Setup with Cloudwatch Logs




This Terraform module implements a comprehensive AWS CloudTrail setup with CloudWatch Logs integration 
for AWS Organizations. It provides centralized logging capabilities with S3 bucket storage, KMS encryption,
and CloudWatch Logs integration. The module supports both organization-wide and account-specific trails,
with customizable event logging, insight selection, and data retention policies. Key features include:
- Centralized S3 bucket with KMS encryption and lifecycle policies
- CloudWatch Logs integration with configurable retention periods
- Multi-region and organization-wide trail support
- Advanced event selectors for granular logging control
- Automated insight event logging
- Customizable log file validation
- SNS topic integration for notifications
- IAM roles and policies with least privilege access
- Automatic bucket naming with custom prefix support
- Compliance with AWS security best practices


---

This project is part of our comprehensive approach towards DevOps Acceleration. 
[<img align="right" title="Share via Email" width="24" height="24" src="https://docs.cloudops.works/images/ionicons/ios-mail.svg"/>][share_email]
[<img align="right" title="Share on Google+" width="24" height="24" src="https://docs.cloudops.works/images/ionicons/logo-googleplus.svg" />][share_googleplus]
[<img align="right" title="Share on Facebook" width="24" height="24" src="https://docs.cloudops.works/images/ionicons/logo-facebook.svg" />][share_facebook]
[<img align="right" title="Share on Reddit" width="24" height="24" src="https://docs.cloudops.works/images/ionicons/logo-reddit.svg" />][share_reddit]
[<img align="right" title="Share on LinkedIn" width="24" height="24" src="https://docs.cloudops.works/images/ionicons/logo-linkedin.svg" />][share_linkedin]
[<img align="right" title="Share on Twitter" width="24" height="24" src="https://docs.cloudops.works/images/ionicons/logo-twitter.svg" />][share_twitter]


[![Terraform Open Source Modules](https://docs.cloudops.works/images/terraform-open-source-modules.svg)][terraform_modules]



It's 100% Open Source and licensed under the [APACHE2](LICENSE).







We have [*lots of terraform modules*][terraform_modules] that are Open Source and we are trying to get them well-maintained!. Check them out!






## Introduction

The AWS Organization CloudTrail Setup module provides a standardized approach to implementing
audit logging and monitoring across your AWS Organization. It follows AWS security best practices
and implements a hub-spoke model where:

Hub Account (Management Account):
- Hosts the central S3 bucket for organization-wide log storage
- Manages KMS keys for log encryption
- Controls CloudWatch Logs configuration
- Defines organization-wide logging policies
- Manages cross-account access permissions

Spoke Accounts (Member Accounts):
- Configure CloudTrail to write to the central bucket
- Implement account-specific logging policies
- Utilize shared KMS keys for encryption
- Forward logs to centralized CloudWatch Logs

Key Architecture Components:
- Centralized S3 bucket with versioning and lifecycle policies
- KMS customer managed keys for enhanced security
- CloudWatch Logs integration with custom log groups
- IAM roles with least privilege access
- SNS topics for notifications and alerts
- Cross-account access policies
- Automatic bucket policy management

## Usage


**IMPORTANT:** The `master` branch is used in `source` just as an example. In your code, do not pin to `master` because there may be breaking changes between releases.
Instead pin to the release tag (e.g. `?ref=vX.Y.Z`) of one of our [latest releases](https://github.com/cloudopsworks/terraform-module-aws-organization-cloudtrail-setup/releases).


To use this module, configure your Terragrunt setup with the following structure:

```hcl
# terragrunt.hcl
terraform {
  source = "git::https://github.com/cloudopsworks/terraform-module-aws-organization-cloudtrail-setup.git?ref=v1.0.0"
}

inputs = {
  is_hub = true  # Set to true for hub account, false for spoke accounts
  settings = {
    cloudtrail_name = "organization-trail"
    cloudtrail_bucket_name = "my-org-cloudtrail-bucket"  # Optional, auto-generated if not specified
    cloudwatch_log_group_name = "cloudtrail-logs"
    cloudtrail_expiration_days = 1825  # 5 years retention
    include_global_service_events = true
    is_multi_region_trail = true
    is_organization_trail = true

    # Optional configurations
    enable_log_file_validation = true
    enable_logging = true
    sns_topic_name = "cloudtrail-notifications"  # Optional

    # CloudWatch Logs configuration
    cloudwatch_logs_retention_days = 30
    enable_cloudwatch_logs = true
  }

  tags = {
    Environment = "production"
    Terraform   = "true"
  }
}
```

## Quick Start

1. Clone the repository:
   ```bash
   git clone https://github.com/cloudopsworks/terraform-module-aws-organization-cloudtrail-setup.git
   ```

2. Create a basic Terragrunt configuration:
   ```hcl
   # terragrunt.hcl
   terraform {
     source = "git::https://github.com/cloudopsworks/terraform-module-aws-organization-cloudtrail-setup.git?ref=v1.0.0"
   }

   inputs = {
     is_hub = true
     settings = {
       cloudtrail_name = "my-organization-trail"
       is_organization_trail = true
       is_multi_region_trail = true
       enable_cloudwatch_logs = true
     }
   }
   ```

3. Initialize and apply:
   ```bash
   terragrunt init
   terragrunt plan
   terragrunt apply
   ```

4. Verify the CloudTrail setup in AWS Console:
   - Check CloudTrail trails
   - Verify S3 bucket creation
   - Confirm CloudWatch Logs integration


## Examples

1. Hub Account Setup (Management Account):
```hcl
# hub/terragrunt.hcl
include {
  path = find_in_parent_folders()
}

inputs = {
  is_hub = true
  settings = {
    cloudtrail_name = "organization-trail"
    is_organization_trail = true
    is_multi_region_trail = true
    enable_cloudwatch_logs = true
    cloudwatch_logs_retention_days = 30
  }
}
```

2. Spoke Account Setup:
```hcl
# spoke/terragrunt.hcl
include {
  path = find_in_parent_folders()
}

inputs = {
  is_hub = false
  settings = {
    cloudtrail_name = "account-specific-trail"
    is_organization_trail = false
    is_multi_region_trail = true
    enable_cloudwatch_logs = true
  }
}
```

3. Custom Event Selectors:
```hcl
# custom-events/terragrunt.hcl
inputs = {
  is_hub = true
  settings = {
    cloudtrail_name = "custom-events-trail"
    event_selector = [
      {
        read_write_type = "All"
        include_management_events = true
        data_resource = {
          type = "AWS::S3::Object"
          values = ["arn:aws:s3:::"]
        }
      }
    ]
  }
}
```



## Makefile Targets
```
Available targets:

  help                                Help screen
  help/all                            Display help for all targets
  help/short                          This help short screen
  lint                                Lint terraform/opentofu code
  tag                                 Tag the current version

```
## Requirements

| Name | Version |
|------|---------|
| <a name="requirement_terraform"></a> [terraform](#requirement\_terraform) | >= 1.3 |
| <a name="requirement_aws"></a> [aws](#requirement\_aws) | ~> 5.81 |

## Providers

| Name | Version |
|------|---------|
| <a name="provider_aws"></a> [aws](#provider\_aws) | ~> 5.81 |
| <a name="provider_random"></a> [random](#provider\_random) | n/a |

## Modules

| Name | Source | Version |
|------|--------|---------|
| <a name="module_cloudtrail"></a> [cloudtrail](#module\_cloudtrail) | terraform-aws-modules/s3-bucket/aws | ~> 4.1 |
| <a name="module_tags"></a> [tags](#module\_tags) | cloudopsworks/tags/local | 1.0.9 |

## Resources

| Name | Type |
|------|------|
| [aws_cloudtrail.this](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/cloudtrail) | resource |
| [aws_cloudwatch_log_group.cloudtrail](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/cloudwatch_log_group) | resource |
| [aws_iam_role.cloudtrail](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/iam_role) | resource |
| [aws_iam_role_policy.cloudtrail](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/iam_role_policy) | resource |
| [aws_kms_alias.cloudtrail](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/kms_alias) | resource |
| [aws_kms_alias.cloudwatch](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/kms_alias) | resource |
| [aws_kms_key.cloudtrail](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/kms_key) | resource |
| [aws_kms_key.cloudwatch](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/kms_key) | resource |
| [aws_organizations_delegated_administrator.this](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/organizations_delegated_administrator) | resource |
| [random_string.cloudtrail](https://registry.terraform.io/providers/hashicorp/random/latest/docs/resources/string) | resource |
| [aws_caller_identity.current](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/data-sources/caller_identity) | data source |
| [aws_iam_policy_document.assume_role](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/data-sources/iam_policy_document) | data source |
| [aws_iam_policy_document.cloudtrail_base](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/data-sources/iam_policy_document) | data source |
| [aws_iam_policy_document.cloudtrail_combined](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/data-sources/iam_policy_document) | data source |
| [aws_iam_policy_document.cloudtrail_role](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/data-sources/iam_policy_document) | data source |
| [aws_iam_policy_document.cloudtrail_s3](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/data-sources/iam_policy_document) | data source |
| [aws_iam_policy_document.cloudwatch_policy](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/data-sources/iam_policy_document) | data source |
| [aws_iam_policy_document.kms_policy](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/data-sources/iam_policy_document) | data source |
| [aws_organizations_organization.current](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/data-sources/organizations_organization) | data source |
| [aws_region.current](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/data-sources/region) | data source |

## Inputs

| Name | Description | Type | Default | Required |
|------|-------------|------|---------|:--------:|
| <a name="input_extra_tags"></a> [extra\_tags](#input\_extra\_tags) | Extra tags to add to the resources | `map(string)` | `{}` | no |
| <a name="input_is_hub"></a> [is\_hub](#input\_is\_hub) | Is this a hub or spoke configuration? | `bool` | `false` | no |
| <a name="input_org"></a> [org](#input\_org) | Organization details | <pre>object({<br/>    organization_name = string<br/>    organization_unit = string<br/>    environment_type  = string<br/>    environment_name  = string<br/>  })</pre> | n/a | yes |
| <a name="input_settings"></a> [settings](#input\_settings) | Module settings for Cloudtrail Setup | `any` | `{}` | no |
| <a name="input_spoke_def"></a> [spoke\_def](#input\_spoke\_def) | Spoke ID Number, must be a 3 digit number | `string` | `"001"` | no |

## Outputs

| Name | Description |
|------|-------------|
| <a name="output_cloudtrail_bucket_name"></a> [cloudtrail\_bucket\_name](#output\_cloudtrail\_bucket\_name) | n/a |
| <a name="output_cloudtrail_kms_key_alias"></a> [cloudtrail\_kms\_key\_alias](#output\_cloudtrail\_kms\_key\_alias) | n/a |
| <a name="output_cloudtrail_kms_key_id"></a> [cloudtrail\_kms\_key\_id](#output\_cloudtrail\_kms\_key\_id) | n/a |
| <a name="output_cloudwatch_kms_key_alias"></a> [cloudwatch\_kms\_key\_alias](#output\_cloudwatch\_kms\_key\_alias) | n/a |
| <a name="output_cloudwatch_kms_key_id"></a> [cloudwatch\_kms\_key\_id](#output\_cloudwatch\_kms\_key\_id) | n/a |
| <a name="output_cloudwatch_log_group_name"></a> [cloudwatch\_log\_group\_name](#output\_cloudwatch\_log\_group\_name) | n/a |



## Help

**Got a question?** We got answers. 

File a GitHub [issue](https://github.com/cloudopsworks/terraform-module-aws-organization-cloudtrail-setup/issues), send us an [email][email] or join our [Slack Community][slack].

[![README Commercial Support][readme_commercial_support_img]][readme_commercial_support_link]

## DevOps Tools

## Slack Community


## Newsletter

## Office Hours

## Contributing

### Bug Reports & Feature Requests

Please use the [issue tracker](https://github.com/cloudopsworks/terraform-module-aws-organization-cloudtrail-setup/issues) to report any bugs or file feature requests.

### Developing




## Copyrights

Copyright © 2024-2025 [Cloud Ops Works LLC](https://cloudops.works)





## License 

[![License](https://img.shields.io/badge/License-Apache%202.0-blue.svg)](https://opensource.org/licenses/Apache-2.0) 

See [LICENSE](LICENSE) for full details.

    Licensed to the Apache Software Foundation (ASF) under one
    or more contributor license agreements.  See the NOTICE file
    distributed with this work for additional information
    regarding copyright ownership.  The ASF licenses this file
    to you under the Apache License, Version 2.0 (the
    "License"); you may not use this file except in compliance
    with the License.  You may obtain a copy of the License at

      https://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing,
    software distributed under the License is distributed on an
    "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, either express or implied.  See the License for the
    specific language governing permissions and limitations
    under the License.









## Trademarks

All other trademarks referenced herein are the property of their respective owners.

## About

This project is maintained by [Cloud Ops Works LLC][website]. 


### Contributors

|  [![Cristian Beraha][berahac_avatar]][berahac_homepage]<br/>[Cristian Beraha][berahac_homepage] |
|---|

  [berahac_homepage]: https://github.com/berahac
  [berahac_avatar]: https://github.com/berahac.png?size=50

[![README Footer][readme_footer_img]][readme_footer_link]
[![Beacon][beacon]][website]

  [logo]: https://cloudops.works/logo-300x69.svg
  [docs]: https://cowk.io/docs?utm_source=github&utm_medium=readme&utm_campaign=cloudopsworks/terraform-module-aws-organization-cloudtrail-setup&utm_content=docs
  [website]: https://cowk.io/homepage?utm_source=github&utm_medium=readme&utm_campaign=cloudopsworks/terraform-module-aws-organization-cloudtrail-setup&utm_content=website
  [github]: https://cowk.io/github?utm_source=github&utm_medium=readme&utm_campaign=cloudopsworks/terraform-module-aws-organization-cloudtrail-setup&utm_content=github
  [jobs]: https://cowk.io/jobs?utm_source=github&utm_medium=readme&utm_campaign=cloudopsworks/terraform-module-aws-organization-cloudtrail-setup&utm_content=jobs
  [hire]: https://cowk.io/hire?utm_source=github&utm_medium=readme&utm_campaign=cloudopsworks/terraform-module-aws-organization-cloudtrail-setup&utm_content=hire
  [slack]: https://cowk.io/slack?utm_source=github&utm_medium=readme&utm_campaign=cloudopsworks/terraform-module-aws-organization-cloudtrail-setup&utm_content=slack
  [linkedin]: https://cowk.io/linkedin?utm_source=github&utm_medium=readme&utm_campaign=cloudopsworks/terraform-module-aws-organization-cloudtrail-setup&utm_content=linkedin
  [twitter]: https://cowk.io/twitter?utm_source=github&utm_medium=readme&utm_campaign=cloudopsworks/terraform-module-aws-organization-cloudtrail-setup&utm_content=twitter
  [testimonial]: https://cowk.io/leave-testimonial?utm_source=github&utm_medium=readme&utm_campaign=cloudopsworks/terraform-module-aws-organization-cloudtrail-setup&utm_content=testimonial
  [office_hours]: https://cloudops.works/office-hours?utm_source=github&utm_medium=readme&utm_campaign=cloudopsworks/terraform-module-aws-organization-cloudtrail-setup&utm_content=office_hours
  [newsletter]: https://cowk.io/newsletter?utm_source=github&utm_medium=readme&utm_campaign=cloudopsworks/terraform-module-aws-organization-cloudtrail-setup&utm_content=newsletter
  [email]: https://cowk.io/email?utm_source=github&utm_medium=readme&utm_campaign=cloudopsworks/terraform-module-aws-organization-cloudtrail-setup&utm_content=email
  [commercial_support]: https://cowk.io/commercial-support?utm_source=github&utm_medium=readme&utm_campaign=cloudopsworks/terraform-module-aws-organization-cloudtrail-setup&utm_content=commercial_support
  [we_love_open_source]: https://cowk.io/we-love-open-source?utm_source=github&utm_medium=readme&utm_campaign=cloudopsworks/terraform-module-aws-organization-cloudtrail-setup&utm_content=we_love_open_source
  [terraform_modules]: https://cowk.io/terraform-modules?utm_source=github&utm_medium=readme&utm_campaign=cloudopsworks/terraform-module-aws-organization-cloudtrail-setup&utm_content=terraform_modules
  [readme_header_img]: https://cloudops.works/readme/header/img
  [readme_header_link]: https://cloudops.works/readme/header/link?utm_source=github&utm_medium=readme&utm_campaign=cloudopsworks/terraform-module-aws-organization-cloudtrail-setup&utm_content=readme_header_link
  [readme_footer_img]: https://cloudops.works/readme/footer/img
  [readme_footer_link]: https://cloudops.works/readme/footer/link?utm_source=github&utm_medium=readme&utm_campaign=cloudopsworks/terraform-module-aws-organization-cloudtrail-setup&utm_content=readme_footer_link
  [readme_commercial_support_img]: https://cloudops.works/readme/commercial-support/img
  [readme_commercial_support_link]: https://cloudops.works/readme/commercial-support/link?utm_source=github&utm_medium=readme&utm_campaign=cloudopsworks/terraform-module-aws-organization-cloudtrail-setup&utm_content=readme_commercial_support_link
  [share_twitter]: https://twitter.com/intent/tweet/?text=Terraform+AWS+Organization+Cloudtrail+Setup+with+Cloudwatch+Logs&url=https://github.com/cloudopsworks/terraform-module-aws-organization-cloudtrail-setup
  [share_linkedin]: https://www.linkedin.com/shareArticle?mini=true&title=Terraform+AWS+Organization+Cloudtrail+Setup+with+Cloudwatch+Logs&url=https://github.com/cloudopsworks/terraform-module-aws-organization-cloudtrail-setup
  [share_reddit]: https://reddit.com/submit/?url=https://github.com/cloudopsworks/terraform-module-aws-organization-cloudtrail-setup
  [share_facebook]: https://facebook.com/sharer/sharer.php?u=https://github.com/cloudopsworks/terraform-module-aws-organization-cloudtrail-setup
  [share_googleplus]: https://plus.google.com/share?url=https://github.com/cloudopsworks/terraform-module-aws-organization-cloudtrail-setup
  [share_email]: mailto:?subject=Terraform+AWS+Organization+Cloudtrail+Setup+with+Cloudwatch+Logs&body=https://github.com/cloudopsworks/terraform-module-aws-organization-cloudtrail-setup
  [beacon]: https://ga-beacon.cloudops.works/G-7XWMFVFXZT/cloudopsworks/terraform-module-aws-organization-cloudtrail-setup?pixel&cs=github&cm=readme&an=terraform-module-aws-organization-cloudtrail-setup
